// Generated by CoffeeScript 1.9.1
(function() {
  var TwilioFlow, VoiceCall;

  VoiceCall = require('./voice-call');

  TwilioFlow = (function() {
    function TwilioFlow() {}

    TwilioFlow.prototype.bind = function(router, app) {
      app.calls = {};
      return router.use("/", function(req, res, next) {
        var call, callId, e, methodName, ref;
        try {
          callId = (ref = req.body) != null ? ref.CallSid : void 0;
          if (callId == null) {
            callId = 0;
          }
          if (!app.calls[callId]) {
            app.calls[callId] = new VoiceCall(app, req);
          }
          call = app.calls[callId];
          call.update(req, res);
          if (call.repeat > app.settings.repeat) {
            methodName = app.settings.noInput;
          } else {
            methodName = req.path.substr(1);
          }
          call.position = methodName;
          return app[methodName](call);
        } catch (_error) {
          e = _error;
          console.log(e);
          return res.send("Error: " + e);
        }
      });
    };

    return TwilioFlow;

  })();

  module.exports = new TwilioFlow();

}).call(this);

//# sourceMappingURL=twilio-flow.js.map
